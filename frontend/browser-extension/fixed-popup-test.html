<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Popup System Test - Working Dropdown & Smaller Size</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #1f2937;
            font-size: 24px;
            margin: 0 0 8px 0;
            font-weight: 800;
        }
        
        .header p {
            color: #6b7280;
            font-size: 14px;
            margin: 0;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h3 {
            color: #374151;
            font-size: 18px;
            margin: 0 0 16px 0;
            font-weight: 700;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .test-button {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        
        .danger { background: #ef4444; color: white; }
        .danger:hover { background: #dc2626; }
        
        .warning { background: #f59e0b; color: white; }
        .warning:hover { background: #d97706; }
        
        .caution { background: #f97316; color: white; }
        .caution:hover { background: #ea580c; }
        
        .safe { background: #10b981; color: white; }
        .safe:hover { background: #059669; }
        
        .utility { background: #6366f1; color: white; }
        .utility:hover { background: #4f46e5; }
        
        .info-section {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-section h4 {
            color: #1d4ed8;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 700;
        }
        
        .improvements {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .improvements h4 {
            color: #047857;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 700;
        }
        
        .improvements ul {
            color: #065f46;
            margin: 0;
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .improvements li {
            margin: 6px 0;
        }
        
        .status-log {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .instructions {
            background: rgba(251, 146, 60, 0.1);
            border: 2px solid rgba(251, 146, 60, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .instructions h4 {
            color: #c2410c;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 700;
        }
        
        .instructions ol {
            color: #9a3412;
            margin: 0;
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .instructions li {
            margin: 6px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>üéØ Fixed Popup System Test</h1>
            <p>Testing the smaller popup with working dropdown functionality</p>
        </div>
        
        <div class="instructions">
            <h4>üöÄ Test Instructions:</h4>
            <ol>
                <li>Click any test button below</li>
                <li>Look for the popup in the <strong>TOP-RIGHT corner</strong></li>
                <li>Click "<strong>View Analysis Details</strong>" to expand dropdown</li>
                <li>The dropdown should smoothly expand with risk bars and reasons</li>
                <li>Click again to collapse (button changes to "Hide Analysis Details")</li>
                <li>Try different alert types to see various risk levels</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>üé® Test Different Alert Types (Smaller Popups)</h3>
            <div class="button-grid">
                <button class="test-button danger" onclick="testHighDanger()">
                    üö® High Danger
                </button>
                <button class="test-button warning" onclick="testWarning()">
                    ‚ö†Ô∏è Warning
                </button>
                <button class="test-button caution" onclick="testCaution()">
                    üü° Caution
                </button>
                <button class="test-button safe" onclick="testSafe()">
                    ‚úÖ Safe Email
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîß Utility Functions</h3>
            <div class="button-grid">
                <button class="test-button utility" onclick="clearAllAlerts()">
                    üßπ Clear All
                </button>
                <button class="test-button utility" onclick="testSequence()">
                    üîÑ Test Sequence
                </button>
                <button class="test-button utility" onclick="testDropdownToggle()">
                    üì± Test Dropdown
                </button>
                <button class="test-button utility" onclick="checkStatus()">
                    üìä Status Check
                </button>
            </div>
        </div>
        
        <div class="improvements">
            <h4>‚úÖ Fixed Issues:</h4>
            <ul>
                <li><strong>Working Dropdown:</strong> Toggle now properly expands/collapses content</li>
                <li><strong>Smaller Size:</strong> Reduced from 380px to 320px width</li>
                <li><strong>Better Animations:</strong> Smoother expand/collapse transitions</li>
                <li><strong>Fixed Event Handlers:</strong> Proper click listeners for dropdown</li>
                <li><strong>Compact Layout:</strong> Reduced padding and font sizes</li>
                <li><strong>Arrow Animation:</strong> Arrow rotates when expanding/collapsing</li>
            </ul>
        </div>
        
        <div class="info-section">
            <h4>üîç Key Features:</h4>
            <p><strong>Dropdown Toggle:</strong> Click "View Analysis Details" to expand full analysis<br>
            <strong>Risk Assessment:</strong> Color-coded explanations based on threat level<br>
            <strong>Progress Bars:</strong> Visual phishing risk vs safety score percentages<br>
            <strong>Detailed Reasons:</strong> List of analysis factors with hover effects<br>
            <strong>Compact Design:</strong> 320px width instead of 380px for better screen usage</p>
        </div>
        
        <div class="test-section">
            <h3>üìã System Logs</h3>
            <div id="status-log" class="status-log">
Fixed popup system initializing...
            </div>
        </div>
    </div>

    <!-- Load the fixed popup system -->
    <script src="fixed-popup-system.js"></script>
    
    <script>
        const statusLog = document.getElementById('status-log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            const logMessage = `${timestamp} ${prefix} ${message}\n`;
            statusLog.textContent += logMessage;
            statusLog.scrollTop = statusLog.scrollHeight;
            console.log(message);
        }
        
        function testHighDanger() {
            log('Testing High Danger Alert (smaller popup)...', 'warning');
            if (window.fixedPhishingAlert) {
                window.fixedPhishingAlert.testHighDanger();
                log('High danger alert created! Click dropdown to expand.', 'success');
            } else {
                log('Fixed popup system not loaded!', 'error');
            }
        }
        
        function testWarning() {
            log('Testing Warning Alert...', 'warning');
            if (window.fixedPhishingAlert) {
                window.fixedPhishingAlert.testWarning();
                log('Warning alert created with working dropdown!', 'success');
            } else {
                log('Fixed popup system not loaded!', 'error');
            }
        }
        
        function testCaution() {
            log('Testing Caution Alert...', 'warning');
            if (window.fixedPhishingAlert) {
                window.fixedPhishingAlert.testCaution();
                log('Caution alert created successfully!', 'success');
            } else {
                log('Fixed popup system not loaded!', 'error');
            }
        }
        
        function testSafe() {
            log('Testing Safe Email Alert...', 'warning');
            if (window.fixedPhishingAlert) {
                window.fixedPhishingAlert.testSafe();
                log('Safe email alert created successfully!', 'success');
            } else {
                log('Fixed popup system not loaded!', 'error');
            }
        }
        
        function clearAllAlerts() {
            log('Clearing all popup alerts...', 'info');
            document.querySelectorAll('.fixed-phishing-alert').forEach(el => {
                el.remove();
            });
            log('All alerts cleared!', 'success');
        }
        
        function testSequence() {
            log('Testing alert sequence...', 'info');
            setTimeout(() => testSafe(), 500);
            setTimeout(() => testCaution(), 2500);
            setTimeout(() => testWarning(), 4500);
            setTimeout(() => testHighDanger(), 6500);
            log('Alert sequence started - watch top-right corner!', 'success');
        }
        
        function testDropdownToggle() {
            log('Testing dropdown toggle functionality...', 'info');
            if (window.fixedPhishingAlert) {
                const alert = window.fixedPhishingAlert.testWarning();
                log('Alert created. Now testing dropdown toggle...', 'info');
                
                setTimeout(() => {
                    const toggleBtn = document.querySelector('.fixed-dropdown-toggle');
                    if (toggleBtn) {
                        toggleBtn.click();
                        log('Dropdown expanded programmatically!', 'success');
                        
                        setTimeout(() => {
                            toggleBtn.click();
                            log('Dropdown collapsed programmatically!', 'success');
                        }, 2000);
                    }
                }, 1000);
            } else {
                log('Fixed popup system not loaded!', 'error');
            }
        }
        
        function checkStatus() {
            log('Checking system status...', 'info');
            
            if (window.fixedPhishingAlert) {
                log('‚úÖ Fixed popup system: LOADED', 'success');
            } else {
                log('‚ùå Fixed popup system: NOT LOADED', 'error');
            }
            
            if (window.completePhishingAlert) {
                log('‚ÑπÔ∏è Complete popup system: Also available', 'info');
            }
            
            log('üîß Popup size: 320px (reduced from 380px)', 'info');
            log('‚ö° Dropdown: Working with proper event handlers', 'info');
            log('üéØ Animation: Smooth expand/collapse transitions', 'info');
            
            log('System status check completed!', 'success');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            log('Fixed popup test page loaded!', 'success');
            
            setTimeout(() => {
                checkStatus();
            }, 1000);
            
            setTimeout(() => {
                log('Ready to test! Click any button to see smaller popup with working dropdown.', 'info');
                log('üí° IMPORTANT: Look in TOP-RIGHT corner for popup alerts!', 'warning');
            }, 2000);
        });
        
        // Monitor dropdown events
        document.addEventListener('click', (e) => {
            if (e.target.closest('.fixed-dropdown-toggle')) {
                log('Dropdown button clicked - toggling expansion state', 'info');
            }
            
            if (e.target.closest('.fixed-alert-close')) {
                log('Close button clicked - removing alert', 'info');
            }
        });
    </script>
</body>
</html>